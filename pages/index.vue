<template>
  <div class="home">
    <header>
      <the-slider />
    </header>

    <section class="home-stories">
      <div class="container">
          <!-- <div class="stories">
            <div class="story">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-device-tv" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5" stroke="#6f32be" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <rect x="3" y="7" width="18" height="13" rx="2" />
                <polyline points="16 3 12 7 8 3" />
              </svg>
              <img src="~/assets/images/stories/story (1).jpg" alt="story">
            </div>
            <div class="story">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-device-tv" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5" stroke="#6f32be" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <rect x="3" y="7" width="18" height="13" rx="2" />
                <polyline points="16 3 12 7 8 3" />
              </svg>
              <img src="~/assets/images/stories/story (2).jpg" alt="story">
            </div>
            <div class="story">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-device-tv" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5" stroke="#6f32be" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <rect x="3" y="7" width="18" height="13" rx="2" />
                <polyline points="16 3 12 7 8 3" />
              </svg>
              <img src="~/assets/images/stories/story (3).jpg" alt="story">
            </div>
            <div class="story">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-device-tv" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5" stroke="#6f32be" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <rect x="3" y="7" width="18" height="13" rx="2" />
                <polyline points="16 3 12 7 8 3" />
              </svg>
              <img src="~/assets/images/stories/story (4).jpg" alt="story">
            </div>
            <div class="story">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-device-tv" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5" stroke="#6f32be" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <rect x="3" y="7" width="18" height="13" rx="2" />
                <polyline points="16 3 12 7 8 3" />
              </svg>
              <img src="~/assets/images/stories/story (2).jpg" alt="story">
            </div>
            <div class="story">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-device-tv" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5" stroke="#6f32be" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <rect x="3" y="7" width="18" height="13" rx="2" />
                <polyline points="16 3 12 7 8 3" />
              </svg>
              <img src="~/assets/images/stories/story (3).jpg" alt="story">
            </div>
            <div class="story">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-device-tv" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5" stroke="#6f32be" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <rect x="3" y="7" width="18" height="13" rx="2" />
                <polyline points="16 3 12 7 8 3" />
              </svg>
              <img src="~/assets/images/stories/story (1).jpg" alt="story">
            </div>
            <div class="story">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-device-tv" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5" stroke="#6f32be" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <rect x="3" y="7" width="18" height="13" rx="2" />
                <polyline points="16 3 12 7 8 3" />
              </svg>
              <img src="~/assets/images/stories/story (3).jpg" alt="story">
            </div>
            <div class="story">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-device-tv" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5" stroke="#6f32be" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <rect x="3" y="7" width="18" height="13" rx="2" />
                <polyline points="16 3 12 7 8 3" />
              </svg>
              <img src="~/assets/images/stories/story (4).jpg" alt="story">
            </div>
            <div class="story">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-device-tv" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5" stroke="#6f32be" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <rect x="3" y="7" width="18" height="13" rx="2" />
                <polyline points="16 3 12 7 8 3" />
              </svg>
              <img src="~/assets/images/stories/story (2).jpg" alt="story">
            </div>
            <div class="story">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-device-tv" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5" stroke="#6f32be" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <rect x="3" y="7" width="18" height="13" rx="2" />
                <polyline points="16 3 12 7 8 3" />
              </svg>
              <img src="~/assets/images/stories/story (3).jpg" alt="story">
            </div>
          </div> -->
      </div>
    </section>

    <!-- <the-new-arrival v-if="newProducts.length > 0" :availableLocales="availableLocales" :newProducts="newProducts"/> -->
    <section class="new-arrival">
      <div class="container">
        <the-header-section :title="$t('new_arrivals')" @slidePrev="slidePrev" @slideNext="slideNext"/>
        <hooper v-if="newProducts.length > 0"  group="new_arrivals" :settings="sliderSettings" ref="carousel" :rtl="availableLocales">
          <slide v-for="item in newProducts" :key="item.id">
            <the-card :item="item"/>
          </slide>
        </hooper>
      </div>
    </section>

    <section class="new-arrival">
      <div class="container">
        <the-header-section :title="availableLocales ? `المنتجات المقترحة` : `Suggested Products`" @slidePrev="slidePrev" @slideNext="slideNext"/>
        <hooper v-if="newProducts.length > 0"  group="new_arrivals" :settings="sliderSettings" ref="carousel" :rtl="availableLocales">
          <slide v-for="item in suggestedProducts" :key="item.id">
            <the-card :item="item"/>
          </slide>
        </hooper>
      </div>
    </section>


    <section class="stores-sec">
      <div class="container">
        <the-header-section :title="$t('stores')"  @slidePrev="slidePrev" @slideNext="slideNext"/>
        <hooper group="home_stores" :settings="sliderSettings" ref="carousel" :rtl="availableLocales">
          <slide v-for="item in allStores" :key="item.id">
            <the-story-card :item="item" />
          </slide>

        </hooper>
      </div>
    </section>

    <section class="stores-sec" v-if="nearsStores.length > 0">
      <div class="container">
        <the-header-section :title="availableLocales ? `المتاجر القريبة` : `Near Stores`"  @slidePrev="slidePrev" @slideNext="slideNext"/>
        <hooper group="home_stores" :settings="sliderSettings" ref="carousel" :rtl="availableLocales">
          <slide v-for="item in nearsStores" :key="item.id">
            <the-story-card :item="item" />
          </slide>

        </hooper>
      </div>
    </section>


    <section class="top-rated">
      <div class="container">
        <the-header-section :title="$t('top_rated')"  @slidePrev="slidePrev" @slideNext="slideNext"/>
        <hooper v-if="topRatedProducts.length > 0"  group="top_rated" :settings="sliderSettings" ref="carousel" :rtl="availableLocales">
          <slide v-for="item in topRatedProducts" :key="item.id">
            <the-card :item="item"/>
          </slide>
        </hooper>
      </div>
    </section>

  </div>
</template>

<script>
import TheCard from '~/components/shared/TheCard.vue'
import TheStoryCard from '~/components/shared/TheStoryCard.vue'
import TheHeaderSection from '~/components/shared/TheHeaderSection.vue'
import TheSlider from '~/components/home/TheSlider.vue'
import { Hooper, Slide } from 'hooper';
import 'hooper/dist/hooper.css';
export default {
  middleware: '',
  data() {
    return {
      sliderSettings: {
        itemsToShow: 4,
        wheelControl: true,
        centerMode: true,
        infiniteScroll: true,
        autoPlay: true,
        playSpeed: 3000,
        transition: 750,
        breakpoints: {
          300: {
            itemsToShow: 1
          },
          1000: {
            itemsToShow: 4
          }
        }
      },
      productsAds: [],
      suggestedProducts: [],
      categories: [],
      newProducts: [],
      ads: [],
      nearsStores: [],
      allStores: [],
      topRatedProducts: []
    }
  },
  components: {
    Hooper,
    Slide,
    TheCard,
    TheStoryCard,
    TheHeaderSection,
    TheSlider
  },
  computed: {
    availableLocales () {
      let local = this.$i18n.locales.filter(i => i.code !== this.$i18n.locale)
      if(local[0].code == 'en'){
        return true
      } else {
        return false
      }
    },
  },
  mounted() {
    // console.log(this.topRatedProducts)
  },
  methods: {
    slidePrev() {
      this.$refs.carousel.slidePrev();
    },
    slideNext() {
      this.$refs.carousel.slideNext();
    }
  },
  async asyncData({ app, $axios , error, i18n }) {
    const home = app.$axios.$get(`home`, {
        headers: {
            "Content-Language": i18n.locale
        }
    })
    // const home = $Api.general.home()
    const responses = await Promise.all([home])
    const badResponse = responses.find((response) => !response.status)
    if(badResponse) return error({ statusCode: badResponse.status, message: badResponse.msg})
    // console.log(responses[0])
    return {
      productsAds: responses[0].data.products_ads,
      suggestedProducts: responses[0].data.suggested_products,
      categories: responses[0].data.categories,
      newProducts: responses[0].data.new_products,
      ads: responses[0].data.ads,
      nearsStores: responses[0].data.nears_stores,
      allStores: responses[0].data.all_stores,
      topRatedProducts: responses[0].data.top_rated_products
    }
  },

}
</script>

<style>
</style>
